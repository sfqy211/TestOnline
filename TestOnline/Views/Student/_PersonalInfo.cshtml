@page
@model PersonalManagementModel
@{
    ViewData["Title"] = "信息管理";
    var studentId = ViewBag.StudentId;
}

<h3>个人信息</h3>

<p>姓名：@Model.Student.Name</p>
<p>学号：@Model.Student.StudentId</p>
<p>班级：@Model.Student.ClassId</p>

<button id="changePasswordButton" onclick="showPasswordFields()">修改密码</button>

<div id="passwordFields" style="display:none;">
    <p>
        <label for="newPassword">请输入密码：</label>
        <input type="password" id="newPassword" />
    </p>
    <p>
        <label for="confirmPassword">请确认密码：</label>
        <input type="password" id="confirmPassword" />
    </p>
    <button onclick="changePassword(@Model.studentId)">提交</button>
    <p id="passwordMessage" style="color:red;"></p>
</div>

@section Scripts {
    <script>
        function showPasswordFields() {
            document.getElementById('passwordFields').style.display = 'block';
        }

        function changePassword(studentId) {
            var newPassword = document.getElementById('newPassword').value;
            var confirmPassword = document.getElementById('confirmPassword').value;
            var messageElement = document.getElementById('passwordMessage');

            if (newPassword !== confirmPassword) {
                messageElement.textContent = '两次输入的密码不相同，请重新输入';
                return;
            }

            fetch('/Student/ChangePassword', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ studentId: studentId, newPassword: newPassword })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    messageElement.style.color = 'green';
                    messageElement.textContent = '密码修改成功';
                } else {
                    messageElement.style.color = 'red';
                    messageElement.textContent = '密码修改失败，请重试';
                }
            });
        }
    </script>
}